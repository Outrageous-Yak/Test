<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Aerin — Threshold</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>

<style>
body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto,Arial;
  background:#05070d;
  color:#eaf2ff;
}
.wrap{
  display:grid;
  grid-template-columns: 2.4fr 1fr 1.4fr 1fr;
  gap:10px;
  height:100vh;
  padding:10px;
}
.panel{
  background:rgba(10,16,34,.6);
  border:1px solid rgba(160,210,255,.22);
  border-radius:14px;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
.header{
  padding:8px 10px;
  font-size:12px;
  opacity:.8;
  border-bottom:1px solid rgba(160,210,255,.15);
}
.chat{
  flex:1;
  overflow:auto;
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.msg{
  padding:8px 10px;
  border-radius:12px;
  max-width:90%;
  white-space:pre-wrap;
}
.user{ align-self:flex-end; background:#2563eb; }
.aerin{ align-self:flex-start; background:#1f2937; }

.counter{
  margin-top:4px;
  font-size:12px;
  font-style:italic;
  color:#39ff6a;
}

.input{
  display:flex;
  gap:6px;
  padding:8px;
  border-top:1px solid rgba(160,210,255,.15);
}
textarea{
  flex:1;
  resize:none;
  background:#020617;
  color:#eaf2ff;
  border-radius:10px;
  border:1px solid rgba(160,210,255,.2);
  padding:8px;
}
button{
  border-radius:10px;
  border:1px solid rgba(160,210,255,.2);
  background:#1d4ed8;
  color:white;
  padding:8px 10px;
  cursor:pointer;
}

.tools{
  padding:10px;
  display:flex;
  gap:8px;
}
.tools button{ flex:1; }

.imagePanel{
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.imagePanel img{
  width:100%;
  border-radius:10px;
  border:1px solid rgba(160,210,255,.2);
}
.small{
  font-size:11px;
  opacity:.7;
}
</style>
</head>

<body>
<div class="wrap">

<!-- CHAT -->
<div class="panel">
  <div class="header">Aerin — Threshold Chat</div>
  <div id="chat" class="chat"></div>
  <div class="input">
    <textarea id="input" rows="2" placeholder="Speak."></textarea>
    <button onclick="send()">Send</button>
  </div>
</div>

<!-- TOOLKIT A -->
<div class="panel">
  <div class="header">Dice</div>
  <div class="tools">
    <button onclick="roll(6)">d6</button>
    <button onclick="roll(12)">d12</button>
    <button onclick="roll(20)">d20</button>
  </div>
</div>

<!-- TOOLKIT B (placeholder for all existing tools) -->
<div class="panel">
  <div class="header">Toolkit</div>
  <div class="small" style="padding:10px">
    All PF2e tools remain here (conditions, encounter, loot, character, tavern).
    This layout preserves space exactly as requested.
  </div>
</div>

<!-- IMAGE -->
<div class="panel">
  <div class="header">Vision</div>
  <div class="imagePanel">
    <img id="visionImg"/>
    <img src="Photo1.png" alt="Aerin"/>
  </div>
</div>

</div>

<script>
const chat=document.getElementById("chat");
let count=0;

const BASE_PROMPT =
"blue-skinned elf woman, white hair, prismatic shield hovering, fantasy, cinematic, pf2e, moody lighting, ancient stone, threshold, no modern elements";

function add(role,text,counter){
  const d=document.createElement("div");
  d.className="msg "+role;
  d.textContent=text;
  if(counter){
    const c=document.createElement("div");
    c.className="counter";
    c.textContent=counter;
    d.appendChild(c);
  }
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
}

add("aerin",
"I’m Aerin.\nBlue-skinned elf.\nWhite hair.\nA prism shield listens.\n\nI form an image every third time I speak."
);

function send(){
  const v=input.value.trim();
  if(!v) return;
  add("user",v);
  input.value="";
  reply(v);
}

function reply(userText){
  count=(count%3)+1;
  let counter="("+count+")";
  if(count===3) counter="image generating";

  add("aerin","I hear it.\nThe threshold shifts.",counter);

  if(count===3){
    const prompt=encodeURIComponent(
      BASE_PROMPT+", scene inspired by: "+userText
    );
    visionImg.src=
      "https://image.pollinations.ai/prompt/"+prompt+
      "?width=512&height=512&seed="+Math.floor(Math.random()*1e9);
  }
}

function roll(s){
  const r=Math.floor(Math.random()*s)+1;
  add("aerin","d"+s+".\nIt lands on "+r+".");
}
</script>
</body>
</html>
